!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var Class=require("uclass"),ucss=require("microcss"),forEach=require("mout/array/forEach");module.exports=function(anchor,options,chain){new LonesomeDom(anchor,options).process(chain)};var LonesomeDom=new Class({Implements:[require("uclass/options")],anchor:null,options:{inlineimages:!1,inlineFonts:!1,fontsDir:"/fonts/",imagesBaseDir:"/resources",AbsolutePath:!1},initialize:function(anchor,options){this.anchor=anchor,this.setOptions(options),this.document=anchor.ownerDocument},$n:function(type,attrs){var out=this.document.createElement(type);for(var k in attrs)k in out?out[k]=attrs[k]:out.setAttribute(k,attrs[k]);return out.inject=function(parent,top){return parent.insertBefore(out,top?parent.firstChild:null),out},out},inlineimg:function(anchor,lastfoo){var self=this,imgs=anchor.querySelectorAll("img"),urls={};forEach(imgs,function(img){if(self.options.inlineimages){var oCanvas=self.$n("canvas",{width:img.offsetWidth,height:img.offsetHeight}),oCtx=oCanvas.getContext("2d");oCtx.drawImage(img,0,0,img.offsetWidth,img.offsetHeight),urls[img.src]=oCanvas.toDataURL()}else self.options.AbsolutePath&&(urls[img.src]=String(img.src))}),imgs=lastfoo.querySelectorAll("img"),forEach(imgs,function(img){img.src=urls[img.src]||img.src})},process:function(chain){for(var container=this.anchor,lastfoo=null,self=this;container!=this.document;){var foo=self.$n(container.nodeName,{className:container.className,style:container.style});container.id&&(foo.id=container.id),container==this.anchor?foo.innerHTML=this.anchor.innerHTML:lastfoo.inject(foo),container=container.parentNode,lastfoo=foo}var head=self.$n("head").inject(lastfoo,"top");self.$n("meta",{"http-equiv":"content-type",content:"text/html",charset:"utf-8"}).inject(head),self.inlineimg(this.anchor,lastfoo);ucss(this.anchor,this.options,function(err,allcss){self.$n("style",{type:"text/css",innerText:allcss}).inject(head),chain(null,lastfoo)})}})},{microcss:33,"mout/array/forEach":3,uclass:16,"uclass/options":15}],2:[function(require,module,exports){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"),path||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;length>i;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}for(var outputParts=[],i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return outputParts=outputParts.concat(toParts.slice(samePartsLength)),outputParts.join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},exports.basename=function(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPath(path)[3]};var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return 0>start&&(start=str.length+start),str.substr(start,len)}},{}],3:[function(require,module,exports){function forEach(arr,callback,thisObj){if(null!=arr)for(var i=-1,len=arr.length;++i<len&&callback.call(thisObj,arr[i],i,arr)!==!1;);}module.exports=forEach},{}],4:[function(require,module,exports){function clone(val){switch(kindOf(val)){case"Object":return cloneObject(val);case"Array":return cloneArray(val);case"RegExp":return cloneRegExp(val);case"Date":return cloneDate(val);default:return val}}function cloneObject(source){return isPlainObject(source)?mixIn({},source):source}function cloneRegExp(r){var flags="";return flags+=r.multiline?"m":"",flags+=r.global?"g":"",flags+=r.ignoreCase?"i":"",new RegExp(r.source,flags)}function cloneDate(date){return new Date(+date)}function cloneArray(arr){return arr.slice()}var kindOf=require("./kindOf"),isPlainObject=require("./isPlainObject"),mixIn=require("../object/mixIn");module.exports=clone},{"../object/mixIn":14,"./isPlainObject":8,"./kindOf":9}],5:[function(require,module,exports){function deepClone(val,instanceClone){switch(kindOf(val)){case"Object":return cloneObject(val,instanceClone);case"Array":return cloneArray(val,instanceClone);default:return clone(val)}}function cloneObject(source,instanceClone){if(isPlainObject(source)){var out={};return forOwn(source,function(val,key){this[key]=deepClone(val,instanceClone)},out),out}return instanceClone?instanceClone(source):source}function cloneArray(arr,instanceClone){for(var out=[],i=-1,n=arr.length;++i<n;)out[i]=deepClone(arr[i],instanceClone);return out}var clone=require("./clone"),forOwn=require("../object/forOwn"),kindOf=require("./kindOf"),isPlainObject=require("./isPlainObject");module.exports=deepClone},{"../object/forOwn":11,"./clone":4,"./isPlainObject":8,"./kindOf":9}],6:[function(require,module,exports){function isKind(val,kind){return kindOf(val)===kind}var kindOf=require("./kindOf");module.exports=isKind},{"./kindOf":9}],7:[function(require,module,exports){function isObject(val){return isKind(val,"Object")}var isKind=require("./isKind");module.exports=isObject},{"./isKind":6}],8:[function(require,module,exports){function isPlainObject(value){return!!value&&"object"==typeof value&&value.constructor===Object}module.exports=isPlainObject},{}],9:[function(require,module,exports){function kindOf(val){return null===val?"Null":val===UNDEF?"Undefined":_rKind.exec(_toString.call(val))[1]}var UNDEF,_rKind=/^\[object (.*)\]$/,_toString=Object.prototype.toString;module.exports=kindOf},{}],10:[function(require,module,exports){function checkDontEnum(){_dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],_hasDontEnumBug=!0;for(var key in{toString:null})_hasDontEnumBug=!1}function forIn(obj,fn,thisObj){var key,i=0;null==_hasDontEnumBug&&checkDontEnum();for(key in obj)if(exec(fn,obj,key,thisObj)===!1)break;if(_hasDontEnumBug)for(var ctor=obj.constructor,isProto=!!ctor&&obj===ctor.prototype;(key=_dontEnums[i++])&&("constructor"===key&&(isProto||!hasOwn(obj,key))||obj[key]===Object.prototype[key]||exec(fn,obj,key,thisObj)!==!1););}function exec(fn,obj,key,thisObj){return fn.call(thisObj,obj[key],key,obj)}var _hasDontEnumBug,_dontEnums,hasOwn=require("./hasOwn");module.exports=forIn},{"./hasOwn":12}],11:[function(require,module,exports){function forOwn(obj,fn,thisObj){forIn(obj,function(val,key){return hasOwn(obj,key)?fn.call(thisObj,obj[key],key,obj):void 0})}var hasOwn=require("./hasOwn"),forIn=require("./forIn");module.exports=forOwn},{"./forIn":10,"./hasOwn":12}],12:[function(require,module,exports){function hasOwn(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=hasOwn},{}],13:[function(require,module,exports){function merge(){var key,val,obj,target,i=1;for(target=deepClone(arguments[0]);obj=arguments[i++];)for(key in obj)hasOwn(obj,key)&&(val=obj[key],isObject(val)&&isObject(target[key])?target[key]=merge(target[key],val):target[key]=deepClone(val));return target}var hasOwn=require("./hasOwn"),deepClone=require("../lang/deepClone"),isObject=require("../lang/isObject");module.exports=merge},{"../lang/deepClone":5,"../lang/isObject":7,"./hasOwn":12}],14:[function(require,module,exports){function mixIn(target,objects){for(var obj,i=0,n=arguments.length;++i<n;)obj=arguments[i],null!=obj&&forOwn(obj,copyProp,target);return target}function copyProp(val,key){this[key]=val}var forOwn=require("./forOwn");module.exports=mixIn},{"./forOwn":11}],15:[function(require,module,exports){var Class=require("uclass"),merge=require("mout/object/merge"),Options=new Class({initialize:function(){this.options||(this.options={})},setOptions:function(options){var args=[{},this.options];return args.push.apply(args,arguments),this.options=merge.apply(null,args),this}});module.exports=Options},{"mout/object/merge":13,uclass:16}],16:[function(require,module,exports){Function.prototype["static"]=function(){return this.$static=!0,this};var uClass=function(obj){var out=function(){obj.Binds&&obj.Binds.forEach(function(f){var original=this[f];original&&(this[f]=original.bind(this))}.bind(this)),obj.initialize.apply(this,arguments)};return out["implements"]=function(obj){for(var i in obj)"function"==typeof obj[i]&&obj[i].$static?out[i]=obj[i]:out.prototype[i]=obj[i]},obj.Implements&&obj.Implements.forEach(function(Mixin){out["implements"](new Mixin)}),out["implements"](obj),out};module.exports=uClass},{}],17:[function(require,module,exports){window.lonesomedom=require("..")},{"..":1}],18:[function(require,module,exports){arguments[4][3][0].apply(exports,arguments)},{dup:3}],19:[function(require,module,exports){arguments[4][4][0].apply(exports,arguments)},{"../object/mixIn":29,"./isPlainObject":23,"./kindOf":24,dup:4}],20:[function(require,module,exports){arguments[4][5][0].apply(exports,arguments)},{"../object/forOwn":26,"./clone":19,"./isPlainObject":23,"./kindOf":24,dup:5}],21:[function(require,module,exports){arguments[4][6][0].apply(exports,arguments)},{"./kindOf":24,dup:6}],22:[function(require,module,exports){arguments[4][7][0].apply(exports,arguments)},{"./isKind":21,dup:7}],23:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{dup:8}],24:[function(require,module,exports){arguments[4][9][0].apply(exports,arguments)},{dup:9}],25:[function(require,module,exports){arguments[4][10][0].apply(exports,arguments)},{"./hasOwn":27,dup:10}],26:[function(require,module,exports){arguments[4][11][0].apply(exports,arguments)},{"./forIn":25,"./hasOwn":27,dup:11}],27:[function(require,module,exports){arguments[4][12][0].apply(exports,arguments)},{dup:12}],28:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{"../lang/deepClone":20,"../lang/isObject":22,"./hasOwn":27,dup:13}],29:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"./forOwn":26,dup:14}],30:[function(require,module,exports){module.exports=function(str){for(var c1,c2,c3,CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",out="",i=0,len=str.length;len>i;){if(c1=255&str.charCodeAt(i++),i==len){out+=CHARS.charAt(c1>>2),out+=CHARS.charAt((3&c1)<<4),out+="==";break}if(c2=str.charCodeAt(i++),i==len){out+=CHARS.charAt(c1>>2),out+=CHARS.charAt((3&c1)<<4|(240&c2)>>4),out+=CHARS.charAt((15&c2)<<2),out+="=";break}c3=str.charCodeAt(i++),out+=CHARS.charAt(c1>>2),out+=CHARS.charAt((3&c1)<<4|(240&c2)>>4),out+=CHARS.charAt((15&c2)<<2|(192&c3)>>6),out+=CHARS.charAt(63&c3)}return out}},{}],31:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15,"mout/object/merge":28,uclass:32}],32:[function(require,module,exports){arguments[4][16][0].apply(exports,arguments)},{dup:16}],33:[function(require,module,exports){var Class=require("uclass"),base64encode=require("ubase64/encode"),forEach=require("mout/array/forEach"),path=require("path"),url={parseDir:function(url){var foo=/https?:\/\/[^\/]+(\/[^?#]+)/;if(!foo.test(url))return url;var path=foo.exec(url)[1];return path.substr(path.lastIndexOf("/"))}};module.exports=function(anchor,options,chain){var args=[].slice.call(arguments);return anchor=args.shift(),chain=args.pop(),options=args.pop(),new uCSS(anchor,options).process(chain)};var uCSS=new Class({Implements:[require("uclass/options")],pseudosRegex:function(){var ignoredPseudos=[":link",":visited",":hover",":active",":focus",":enabled",":disabled",":checked",":indeterminate","::first-line","::first-letter","::selection","::before","::after",":target",":before",":after"];return new RegExp("([^,: ])(?:"+ignoredPseudos.join("|")+")","g")}(),anchor:null,parentPath:null,options:{inlineimages:!1,inlineFonts:!1,fontsDir:"/fonts/",imagesBaseDir:"/resources",AbsolutePath:!1},initialize:function(anchor,options){this.anchor=anchor,this.setOptions(options),this.document=anchor.ownerDocument,this.window=this.document.defaultView;var container=anchor;for(this.parentPath=[anchor];container!=this.document.documentElement;)this.parentPath.push(container=container.parentNode);this.parentPath.reverse()},getBinary:function(url){var XMLHttpRequest=this.window.XMLHttpRequest,xhr=new XMLHttpRequest;return xhr.open("GET",url,!1),xhr.overrideMimeType("text/plain; charset=x-user-defined"),xhr.send(null),xhr.responseText},process:function(chain){var out=[],self=this;forEach(this.document.styleSheets,function(style,index){style.rules&&forEach(style.rules,function(rule){out=out.concat(self.recss(rule))})}),chain(null,out.join(""))},recss:function(rule){var out=[],self=this,remoteMatch=new RegExp("url\\((.*)\\)");if(rule instanceof this.window.CSSFontFaceRule){var src=rule.style.src,outFace=rule.cssText;if(remoteMatch.test(src)){var fontPath,fontUrl=remoteMatch.exec(src)[1];if(self.options.inlineFonts){var base64EncodedFont=base64encode(this.getBinary(fontUrl));fontPath="url('data:application/font-ttf;base64, "+base64EncodedFont+"')"}else fontPath="url('"+self.options.fontsDir+url.parseDir(fontUrl)+"')";outFace=outFace.replace(remoteMatch,fontPath)}return out.push(outFace),out}if(rule instanceof this.window.CSSMediaRule&&(out.push("@media "+rule.media.mediaText+"{ "),forEach(rule.cssRules,function(rule){out=out.concat(self.recss(rule))}),out.push("}")),!rule.selectorText)return out;for(var selector=rule.selectorText.replace(this.pseudosRegex,"$1"),elements=this.document.querySelectorAll(selector),i=0;i<elements.length;i++){var parent=elements.item(i),hi=this.parentPath.indexOf(parent);for(-1!=hi&&2>hi&&(parent=this.anchor);parent!=this.document.documentElement&&parent!=this.anchor;)parent=parent.parentNode;if(parent==this.anchor){var topush=rule.cssText;if(remoteMatch.test(topush)){var imageUrl=remoteMatch.exec(topush)[1].replace(new RegExp('"',"g"),"");if(self.options.inlineimages){var base64Image=base64encode(this.getBinary(self.options.imagesBaseDir+imageUrl));imagePath="url('data:image/jpg;base64, "+base64Image+"')",topush=topush.replace(remoteMatch,imagePath),out.push(topush)}if(self.options.AbsolutePath){var absoluteUrl=path.join(self.options.AbsolutePath,self.options.imagesBaseDir,imageUrl),imagePath="url('"+absoluteUrl+"')";topush=topush.replace(remoteMatch,imagePath),out.push(topush)}}out.push(topush);break}}return out}})},{"mout/array/forEach":18,path:2,"ubase64/encode":30,uclass:32,"uclass/options":31}]},{},[17]);